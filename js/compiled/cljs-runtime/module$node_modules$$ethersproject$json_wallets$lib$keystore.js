shadow$provide.module$node_modules$$ethersproject$json_wallets$lib$keystore=function(global,require,module,exports){function _getAccount(data,key){var ciphertext=utils_1.looseArrayify(utils_1.searchPath(data,"crypto/ciphertext"));if(bytes_1.hexlify(keccak256_1.keccak256(bytes_1.concat([key.slice(16,32),ciphertext]))).substring(2)!==utils_1.searchPath(data,"crypto/mac").toLowerCase())throw Error("invalid password");var privateKey=key.slice(0,16);if("aes-128-ctr"===utils_1.searchPath(data,"crypto/cipher")){var iv=
utils_1.looseArrayify(utils_1.searchPath(data,"crypto/cipherparams/iv"));iv=new aes_js_1.default.Counter(iv);privateKey=new aes_js_1.default.ModeOfOperation.ctr(privateKey,iv);privateKey=bytes_1.arrayify(privateKey.decrypt(ciphertext))}else privateKey=null;privateKey||logger.throwError("unsupported cipher",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"decrypt"});ciphertext=key.slice(32,64);key=transactions_1.computeAddress(privateKey);if(data.address&&(iv=data.address.toLowerCase(),"0x"!==
iv.substring(0,2)&&(iv="0x"+iv),address_1.getAddress(iv)!==key))throw Error("address mismatch");key={_isKeystoreAccount:!0,address:key,privateKey:bytes_1.hexlify(privateKey)};if("0.1"===utils_1.searchPath(data,"x-ethers/version")){privateKey=utils_1.looseArrayify(utils_1.searchPath(data,"x-ethers/mnemonicCiphertext"));iv=utils_1.looseArrayify(utils_1.searchPath(data,"x-ethers/mnemonicCounter"));iv=new aes_js_1.default.Counter(iv);iv=new aes_js_1.default.ModeOfOperation.ctr(ciphertext,iv);ciphertext=
utils_1.searchPath(data,"x-ethers/path")||hdnode_1.defaultPath;data=utils_1.searchPath(data,"x-ethers/locale")||"en";privateKey=bytes_1.arrayify(iv.decrypt(privateKey));try{var mnemonic=hdnode_1.entropyToMnemonic(privateKey,data),node=hdnode_1.HDNode.fromMnemonic(mnemonic,null,data).derivePath(ciphertext);if(node.privateKey!=key.privateKey)throw Error("mnemonic mismatch");key.mnemonic=node.mnemonic}catch(error){if(error.code!==logger_1.Logger.errors.INVALID_ARGUMENT||"wordlist"!==error.argument)throw error;
}}return new KeystoreAccount(key)}function pbkdf2Sync(passwordBytes,salt,count,dkLen,prfFunc){return bytes_1.arrayify(pbkdf2_1.pbkdf2(passwordBytes,salt,count,dkLen,prfFunc))}function pbkdf2(passwordBytes,salt,count,dkLen,prfFunc){return Promise.resolve(pbkdf2Sync(passwordBytes,salt,count,dkLen,prfFunc))}function _computeKdfKey(data,password,pbkdf2Func,scryptFunc,progressCallback){password=utils_1.getPassword(password);var kdf=utils_1.searchPath(data,"crypto/kdf");if(kdf&&"string"===typeof kdf){var throwError=
function(name,value){return logger.throwArgumentError("invalid key-derivation function parameters",name,value)};if("scrypt"===kdf.toLowerCase()){var salt=utils_1.looseArrayify(utils_1.searchPath(data,"crypto/kdfparams/salt"));pbkdf2Func=parseInt(utils_1.searchPath(data,"crypto/kdfparams/n"));var r=parseInt(utils_1.searchPath(data,"crypto/kdfparams/r")),p=parseInt(utils_1.searchPath(data,"crypto/kdfparams/p"));pbkdf2Func&&r&&p||throwError("kdf",kdf);0!==(pbkdf2Func&pbkdf2Func-1)&&throwError("N",pbkdf2Func);
data=parseInt(utils_1.searchPath(data,"crypto/kdfparams/dklen"));32!==data&&throwError("dklen",data);return scryptFunc(password,salt,pbkdf2Func,r,p,64,progressCallback)}if("pbkdf2"===kdf.toLowerCase())return salt=utils_1.looseArrayify(utils_1.searchPath(data,"crypto/kdfparams/salt")),scryptFunc=null,progressCallback=utils_1.searchPath(data,"crypto/kdfparams/prf"),"hmac-sha256"===progressCallback?scryptFunc="sha256":"hmac-sha512"===progressCallback?scryptFunc="sha512":throwError("prf",progressCallback),
progressCallback=parseInt(utils_1.searchPath(data,"crypto/kdfparams/c")),data=parseInt(utils_1.searchPath(data,"crypto/kdfparams/dklen")),32!==data&&throwError("dklen",data),pbkdf2Func(password,salt,progressCallback,data,scryptFunc)}return logger.throwArgumentError("unsupported key-derivation function","kdf",kdf)}var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=
b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof
P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,
v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;
continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&
(g[Symbol.iterator]=function(){return this}),g};global=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{"default":mod}};Object.defineProperty(exports,"__esModule",{value:!0});exports.encrypt=exports.decrypt=exports.decryptSync=exports.KeystoreAccount=void 0;var aes_js_1=global(require("module$node_modules$aes_js$index")),scrypt_js_1=global(require("module$node_modules$scrypt_js$scrypt")),address_1=require("module$node_modules$$ethersproject$address$lib$index"),bytes_1=require("module$node_modules$$ethersproject$bytes$lib$index"),
hdnode_1=require("module$node_modules$$ethersproject$hdnode$lib$index"),keccak256_1=require("module$node_modules$$ethersproject$keccak256$lib$index"),pbkdf2_1=require("module$node_modules$$ethersproject$pbkdf2$lib$index"),random_1=require("module$node_modules$$ethersproject$random$lib$index");global=require("module$node_modules$$ethersproject$properties$lib$index");var transactions_1=require("module$node_modules$$ethersproject$transactions$lib$index"),utils_1=require("module$node_modules$$ethersproject$json_wallets$lib$utils"),
logger_1=require("module$node_modules$$ethersproject$logger$lib$index");require=require("module$node_modules$$ethersproject$json_wallets$lib$_version");var logger=new logger_1.Logger(require.version),KeystoreAccount=function(_super){function KeystoreAccount(){return null!==_super&&_super.apply(this,arguments)||this}__extends(KeystoreAccount,_super);KeystoreAccount.prototype.isKeystoreAccount=function(value){return!(!value||!value._isKeystoreAccount)};return KeystoreAccount}(global.Description);exports.KeystoreAccount=
KeystoreAccount;exports.decryptSync=function(json,password){json=JSON.parse(json);password=_computeKdfKey(json,password,pbkdf2Sync,scrypt_js_1.default.syncScrypt);return _getAccount(json,password)};exports.decrypt=function(json,password,progressCallback){return __awaiter(this,void 0,void 0,function(){var data,key;return __generator(this,function(_a){switch(_a.label){case 0:return data=JSON.parse(json),[4,_computeKdfKey(data,password,pbkdf2,scrypt_js_1.default.scrypt,progressCallback)];case 1:return key=
_a.sent(),[2,_getAccount(data,key)]}})})};exports.encrypt=function(account,password,options,progressCallback){try{if(address_1.getAddress(account.address)!==transactions_1.computeAddress(account.privateKey))throw Error("address/privateKey mismatch");if(null!=account&&account.mnemonic&&account.mnemonic.phrase){var mnemonic=account.mnemonic;if(hdnode_1.HDNode.fromMnemonic(mnemonic.phrase,null,mnemonic.locale).derivePath(mnemonic.path||hdnode_1.defaultPath).privateKey!=account.privateKey)throw Error("mnemonic mismatch");
}}catch(e){return Promise.reject(e)}"function"!==typeof options||progressCallback||(progressCallback=options,options={});options||(options={});var privateKey=bytes_1.arrayify(account.privateKey);password=utils_1.getPassword(password);var entropy=null,path=null,locale=null;null!=account&&account.mnemonic&&account.mnemonic.phrase&&(mnemonic=account.mnemonic,entropy=bytes_1.arrayify(hdnode_1.mnemonicToEntropy(mnemonic.phrase,mnemonic.locale||"en")),path=mnemonic.path||hdnode_1.defaultPath,locale=mnemonic.locale||
"en");var client=options.client;client||(client="ethers.js");var salt=null;salt=options.salt?bytes_1.arrayify(options.salt):random_1.randomBytes(32);var iv=null;if(options.iv){if(iv=bytes_1.arrayify(options.iv),16!==iv.length)throw Error("invalid iv");}else iv=random_1.randomBytes(16);var uuidRandom=null;if(options.uuid){if(uuidRandom=bytes_1.arrayify(options.uuid),16!==uuidRandom.length)throw Error("invalid uuid");}else uuidRandom=random_1.randomBytes(16);var N=131072,r=8,p=1;options.scrypt&&(options.scrypt.N&&
(N=options.scrypt.N),options.scrypt.r&&(r=options.scrypt.r),options.scrypt.p&&(p=options.scrypt.p));return scrypt_js_1.default.scrypt(password,salt,N,r,p,64,progressCallback).then(function(key){key=bytes_1.arrayify(key);var derivedKey=key.slice(0,16),macPrefix=key.slice(16,32);key=key.slice(32,64);var counter=new aes_js_1.default.Counter(iv);derivedKey=new aes_js_1.default.ModeOfOperation.ctr(derivedKey,counter);derivedKey=bytes_1.arrayify(derivedKey.encrypt(privateKey));macPrefix=keccak256_1.keccak256(bytes_1.concat([macPrefix,
derivedKey]));macPrefix={address:account.address.substring(2).toLowerCase(),id:utils_1.uuidV4(uuidRandom),version:3,Crypto:{cipher:"aes-128-ctr",cipherparams:{iv:bytes_1.hexlify(iv).substring(2)},ciphertext:bytes_1.hexlify(derivedKey).substring(2),kdf:"scrypt",kdfparams:{salt:bytes_1.hexlify(salt).substring(2),n:N,dklen:32,p,r},mac:macPrefix.substring(2)}};entropy&&(derivedKey=random_1.randomBytes(16),counter=new aes_js_1.default.Counter(derivedKey),key=new aes_js_1.default.ModeOfOperation.ctr(key,
counter),key=bytes_1.arrayify(key.encrypt(entropy)),counter=new Date,counter=counter.getUTCFullYear()+"-"+utils_1.zpad(counter.getUTCMonth()+1,2)+"-"+utils_1.zpad(counter.getUTCDate(),2)+"T"+utils_1.zpad(counter.getUTCHours(),2)+"-"+utils_1.zpad(counter.getUTCMinutes(),2)+"-"+utils_1.zpad(counter.getUTCSeconds(),2)+".0Z",macPrefix["x-ethers"]={client,gethFilename:"UTC--"+counter+"--"+macPrefix.address,mnemonicCounter:bytes_1.hexlify(derivedKey).substring(2),mnemonicCiphertext:bytes_1.hexlify(key).substring(2),
path,locale,version:"0.1"});return JSON.stringify(macPrefix)})}}
//# sourceMappingURL=module$node_modules$$ethersproject$json_wallets$lib$keystore.js.map
