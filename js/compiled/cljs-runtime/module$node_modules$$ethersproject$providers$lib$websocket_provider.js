shadow$provide.module$node_modules$$ethersproject$providers$lib$websocket_provider=function(global,require,module,exports){var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=
d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}
function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||
((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=
t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});exports.WebSocketProvider=void 0;var bignumber_1=
require("module$node_modules$$ethersproject$bignumber$lib$index"),properties_1=require("module$node_modules$$ethersproject$properties$lib$index");global=require("module$node_modules$$ethersproject$providers$lib$json_rpc_provider");var ws_1=require("module$node_modules$$ethersproject$providers$lib$ws"),logger_1=require("module$node_modules$$ethersproject$logger$lib$index");require=require("module$node_modules$$ethersproject$providers$lib$_version");var logger=new logger_1.Logger(require.version),NextId=
1;require=function(_super){function WebSocketProvider(url,network){var _this=this;"any"===network&&logger.throwError("WebSocketProvider does not support 'any' network yet",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"network:any"});_this=_super.call(this,url,network)||this;_this._pollingInterval=-1;_this._wsReady=!1;properties_1.defineReadOnly(_this,"_websocket",new ws_1.WebSocket(_this.connection.url));properties_1.defineReadOnly(_this,"_requests",{});properties_1.defineReadOnly(_this,
"_subs",{});properties_1.defineReadOnly(_this,"_subIds",{});properties_1.defineReadOnly(_this,"_detectNetwork",_super.prototype.detectNetwork.call(_this));_this._websocket.onopen=function(){_this._wsReady=!0;Object.keys(_this._requests).forEach(function(id){_this._websocket.send(_this._requests[id].payload)})};_this._websocket.onmessage=function(messageEvent){var data=messageEvent.data;messageEvent=JSON.parse(data);if(null!=messageEvent.id){var id=String(messageEvent.id),request=_this._requests[id];
delete _this._requests[id];void 0!==messageEvent.result?(request.callback(null,messageEvent.result),_this.emit("debug",{action:"response",request:JSON.parse(request.payload),response:messageEvent.result,provider:_this})):(messageEvent.error?(id=Error(messageEvent.error.message||"unknown error"),properties_1.defineReadOnly(id,"code",messageEvent.error.code||null),properties_1.defineReadOnly(id,"response",data)):id=Error("unknown error"),request.callback(id,void 0),_this.emit("debug",{action:"response",
error:id,request:JSON.parse(request.payload),provider:_this}))}else"eth_subscription"===messageEvent.method?(data=_this._subs[messageEvent.params.subscription])&&data.processFunc(messageEvent.params.result):console.warn("this should not happen")};url=setInterval(function(){_this.emit("poll")},1E3);url.unref&&url.unref();return _this}__extends(WebSocketProvider,_super);WebSocketProvider.prototype.detectNetwork=function(){return this._detectNetwork};Object.defineProperty(WebSocketProvider.prototype,
"pollingInterval",{get:function(){return 0},set:function(value){logger.throwError("cannot set polling interval on WebSocketProvider",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"setPollingInterval"})},enumerable:!1,configurable:!0});WebSocketProvider.prototype.resetEventsBlock=function(blockNumber){logger.throwError("cannot reset events block on WebSocketProvider",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"resetEventBlock"})};WebSocketProvider.prototype.poll=function(){return __awaiter(this,
void 0,void 0,function(){return __generator(this,function(_a){return[2,null]})})};Object.defineProperty(WebSocketProvider.prototype,"polling",{set:function(value){value&&logger.throwError("cannot set polling on WebSocketProvider",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"setPolling"})},enumerable:!1,configurable:!0});WebSocketProvider.prototype.send=function(method,params){var _this=this,rid=NextId++;return new Promise(function(resolve,reject){var payload=JSON.stringify({method,params,
id:rid,jsonrpc:"2.0"});_this.emit("debug",{action:"request",request:JSON.parse(payload),provider:_this});_this._requests[String(rid)]={callback:function(error,result){return error?reject(error):resolve(result)},payload};_this._wsReady&&_this._websocket.send(payload)})};WebSocketProvider.defaultUrl=function(){return"ws://localhost:8546"};WebSocketProvider.prototype._subscribe=function(tag,param$jscomp$0,processFunc){return __awaiter(this,void 0,void 0,function(){var subIdPromise,subId,_this=this;return __generator(this,
function(_a){switch(_a.label){case 0:return subIdPromise=this._subIds[tag],null==subIdPromise&&(subIdPromise=Promise.all(param$jscomp$0).then(function(param){return _this.send("eth_subscribe",param)}),this._subIds[tag]=subIdPromise),[4,subIdPromise];case 1:return subId=_a.sent(),this._subs[subId]={tag,processFunc},[2]}})})};WebSocketProvider.prototype._startEvent=function(event$jscomp$0){var _this=this;switch(event$jscomp$0.type){case "block":this._subscribe("block",["newHeads"],function(result){result=
bignumber_1.BigNumber.from(result.number).toNumber();_this._emitted.block=result;_this.emit("block",result)});break;case "pending":this._subscribe("pending",["newPendingTransactions"],function(result){_this.emit("pending",result)});break;case "filter":this._subscribe(event$jscomp$0.tag,["logs",this._getFilter(event$jscomp$0.filter)],function(result){null==result.removed&&(result.removed=!1);_this.emit(event$jscomp$0.filter,_this.formatter.filterLog(result))});break;case "tx":var emitReceipt_1=function(event){var hash=
event.hash;_this.getTransactionReceipt(hash).then(function(receipt){receipt&&_this.emit(hash,receipt)})};emitReceipt_1(event$jscomp$0);this._subscribe("tx",["newHeads"],function(result){_this._events.filter(function(e){return"tx"===e.type}).forEach(emitReceipt_1)});break;case "debug":case "poll":case "willPoll":case "didPoll":case "error":break;default:console.log("unhandled:",event$jscomp$0)}};WebSocketProvider.prototype._stopEvent=function(event){var _this=this,tag=event.tag;if("tx"===event.type){if(this._events.filter(function(e){return"tx"===
e.type}).length)return;tag="tx"}else if(this.listenerCount(event.event))return;if(event=this._subIds[tag])delete this._subIds[tag],event.then(function(subId){_this._subs[subId]&&(delete _this._subs[subId],_this.send("eth_unsubscribe",[subId]))})};WebSocketProvider.prototype.destroy=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return this._websocket.readyState!==ws_1.WebSocket.CONNECTING?[3,2]:[4,new Promise(function(resolve){_this._websocket.onopen=
function(){resolve(!0)};_this._websocket.onerror=function(){resolve(!1)}})];case 1:_a.sent(),_a.label=2;case 2:return this._websocket.close(1E3),[2]}})})};return WebSocketProvider}(global.JsonRpcProvider);exports.WebSocketProvider=require}
//# sourceMappingURL=module$node_modules$$ethersproject$providers$lib$websocket_provider.js.map
