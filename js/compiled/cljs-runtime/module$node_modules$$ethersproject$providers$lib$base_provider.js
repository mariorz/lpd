shadow$provide.module$node_modules$$ethersproject$providers$lib$base_provider=function(global,require,module,exports){function checkTopic(topic){if(null==topic)return"null";32!==bytes_1.hexDataLength(topic)&&logger.throwArgumentError("invalid topic","topic",topic);return topic.toLowerCase()}function serializeTopics(topics){for(topics=topics.slice();0<topics.length&&null==topics[topics.length-1];)topics.pop();return topics.map(function(topic$jscomp$0){if(Array.isArray(topic$jscomp$0)){var unique_1=
{};topic$jscomp$0.forEach(function(topic){unique_1[checkTopic(topic)]=!0});topic$jscomp$0=Object.keys(unique_1);topic$jscomp$0.sort();return topic$jscomp$0.join("|")}return checkTopic(topic$jscomp$0)}).join("\x26")}function deserializeTopics(data){return""===data?[]:data.split(/&/g).map(function(topic$jscomp$0){if(""===topic$jscomp$0)return[];topic$jscomp$0=topic$jscomp$0.split("|").map(function(topic){return"null"===topic?null:topic});return 1===topic$jscomp$0.length?topic$jscomp$0[0]:topic$jscomp$0})}
function getEventTag(eventName){if("string"===typeof eventName){eventName=eventName.toLowerCase();if(32===bytes_1.hexDataLength(eventName))return"tx:"+eventName;if(-1===eventName.indexOf(":"))return eventName}else{if(Array.isArray(eventName))return"filter:*:"+serializeTopics(eventName);if(abstract_provider_1.ForkEvent.isForkEvent(eventName))throw logger.warn("not implemented"),Error("not implemented");if(eventName&&"object"===typeof eventName)return"filter:"+(eventName.address||"*")+":"+serializeTopics(eventName.topics||
[])}throw Error("invalid event - "+eventName);}function getTime(){return(new Date).getTime()}function stall(duration){return new Promise(function(resolve){setTimeout(resolve,duration)})}function bytes32ify(value){return bytes_1.hexZeroPad(bignumber_1.BigNumber.from(value).toHexString(),32)}function base58Encode(data){return basex_1.Base58.encode(bytes_1.concat([data,bytes_1.hexDataSlice(sha2_1.sha256(sha2_1.sha256(data)),0,4)]))}var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,
b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),
__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,
_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=
[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&
1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};global=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{"default":mod}};Object.defineProperty(exports,"__esModule",{value:!0});exports.BaseProvider=exports.Resolver=exports.Event=void 0;var abstract_provider_1=require("module$node_modules$$ethersproject$abstract_provider$lib$index"),basex_1=require("module$node_modules$$ethersproject$basex$lib$index"),
bignumber_1=require("module$node_modules$$ethersproject$bignumber$lib$index"),bytes_1=require("module$node_modules$$ethersproject$bytes$lib$index"),constants_1=require("module$node_modules$$ethersproject$constants$lib$index"),hash_1=require("module$node_modules$$ethersproject$hash$lib$index"),networks_1=require("module$node_modules$$ethersproject$networks$lib$index"),properties_1=require("module$node_modules$$ethersproject$properties$lib$index"),sha2_1=require("module$node_modules$$ethersproject$sha2$lib$index"),
strings_1=require("module$node_modules$$ethersproject$strings$lib$index"),web_1=require("module$node_modules$$ethersproject$web$lib$index"),bech32_1=global(require("module$node_modules$bech32$index")),logger_1=require("module$node_modules$$ethersproject$logger$lib$index");global=require("module$node_modules$$ethersproject$providers$lib$_version");var logger=new logger_1.Logger(global.version),formatter_1=require("module$node_modules$$ethersproject$providers$lib$formatter"),PollableEvents=["block",
"network","pending","poll"],Event$jscomp$0=function(){function Event(tag,listener,once){properties_1.defineReadOnly(this,"tag",tag);properties_1.defineReadOnly(this,"listener",listener);properties_1.defineReadOnly(this,"once",once)}Object.defineProperty(Event.prototype,"event",{get:function(){switch(this.type){case "tx":return this.hash;case "filter":return this.filter}return this.tag},enumerable:!1,configurable:!0});Object.defineProperty(Event.prototype,"type",{get:function(){return this.tag.split(":")[0]},
enumerable:!1,configurable:!0});Object.defineProperty(Event.prototype,"hash",{get:function(){var comps=this.tag.split(":");return"tx"!==comps[0]?null:comps[1]},enumerable:!1,configurable:!0});Object.defineProperty(Event.prototype,"filter",{get:function(){var comps=this.tag.split(":");if("filter"!==comps[0])return null;var address=comps[1];comps=deserializeTopics(comps[2]);var filter={};0<comps.length&&(filter.topics=comps);address&&"*"!==address&&(filter.address=address);return filter},enumerable:!1,
configurable:!0});Event.prototype.pollable=function(){return 0<=this.tag.indexOf(":")||0<=PollableEvents.indexOf(this.tag)};return Event}();exports.Event=Event$jscomp$0;var coinInfos={0:{symbol:"btc",p2pkh:0,p2sh:5,prefix:"bc"},2:{symbol:"ltc",p2pkh:48,p2sh:50,prefix:"ltc"},3:{symbol:"doge",p2pkh:30,p2sh:22},60:{symbol:"eth",ilk:"eth"},61:{symbol:"etc",ilk:"eth"},700:{symbol:"xdai",ilk:"eth"}},Resolver=function(){function Resolver(provider,address,name){properties_1.defineReadOnly(this,"provider",
provider);properties_1.defineReadOnly(this,"name",name);properties_1.defineReadOnly(this,"address",provider.formatter.address(address))}Resolver.prototype._fetchBytes=function(selector,parameters){return __awaiter(this,void 0,void 0,function(){var transaction,result,offset,length;return __generator(this,function(_a){switch(_a.label){case 0:return transaction={to:this.address,data:bytes_1.hexConcat([selector,hash_1.namehash(this.name),parameters||"0x"])},[4,this.provider.call(transaction)];case 1:result=
_a.sent();if("0x"===result)return[2,null];offset=bignumber_1.BigNumber.from(bytes_1.hexDataSlice(result,0,32)).toNumber();length=bignumber_1.BigNumber.from(bytes_1.hexDataSlice(result,offset,offset+32)).toNumber();return[2,bytes_1.hexDataSlice(result,offset+32,offset+32+length)]}})})};Resolver.prototype._getAddress=function(coinType,hexBytes){var coinInfo=coinInfos[String(coinType)];null==coinInfo&&logger.throwError("unsupported coin type: "+coinType,logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"getAddress("+
coinType+")"});if("eth"===coinInfo.ilk)return this.provider.formatter.address(hexBytes);coinType=bytes_1.arrayify(hexBytes);if(null!=coinInfo.p2pkh){var p2pkh=hexBytes.match(/^0x76a9([0-9a-f][0-9a-f])([0-9a-f]*)88ac$/);if(p2pkh){var length_1=parseInt(p2pkh[1],16);if(p2pkh[2].length===2*length_1&&1<=length_1&&75>=length_1)return base58Encode(bytes_1.concat([[coinInfo.p2pkh],"0x"+p2pkh[2]]))}}return null!=coinInfo.p2sh&&(hexBytes=hexBytes.match(/^0xa9([0-9a-f][0-9a-f])([0-9a-f]*)87$/))&&(p2pkh=parseInt(hexBytes[1],
16),hexBytes[2].length===2*p2pkh&&1<=p2pkh&&75>=p2pkh)?base58Encode(bytes_1.concat([[coinInfo.p2sh],"0x"+hexBytes[2]])):null!=coinInfo.prefix&&(p2pkh=coinType[1],hexBytes=coinType[0],0===hexBytes?20!==p2pkh&&32!==p2pkh&&(hexBytes=-1):hexBytes=-1,0<=hexBytes&&coinType.length===2+p2pkh&&1<=p2pkh&&75>=p2pkh)?(coinType=bech32_1.default.toWords(coinType.slice(2)),coinType.unshift(hexBytes),bech32_1.default.encode(coinInfo.prefix,coinType)):null};Resolver.prototype.getAddress=function(coinType){return __awaiter(this,
void 0,void 0,function(){var transaction,hexBytes_1,hexBytes,address;return __generator(this,function(_a){switch(_a.label){case 0:null==coinType&&(coinType=60);if(60!==coinType)return[3,2];transaction={to:this.address,data:"0x3b3b57de"+hash_1.namehash(this.name).substring(2)};return[4,this.provider.call(transaction)];case 1:return hexBytes_1=_a.sent(),"0x"===hexBytes_1||hexBytes_1===constants_1.HashZero?[2,null]:[2,this.provider.formatter.callAddress(hexBytes_1)];case 2:return[4,this._fetchBytes("0xf1cb7e06",
bytes32ify(coinType))];case 3:hexBytes=_a.sent();if(null==hexBytes||"0x"===hexBytes)return[2,null];address=this._getAddress(coinType,hexBytes);null==address&&logger.throwError("invalid or unsupported coin data",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"getAddress("+coinType+")",coinType,data:hexBytes});return[2,address]}})})};Resolver.prototype.getContentHash=function(){return __awaiter(this,void 0,void 0,function(){var hexBytes,ipfs,length_4,swarm;return __generator(this,function(_a){switch(_a.label){case 0:return[4,
this._fetchBytes("0xbc1c58d1")];case 1:hexBytes=_a.sent();if(null==hexBytes||"0x"===hexBytes)return[2,null];if(ipfs=hexBytes.match(/^0xe3010170(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/))if(length_4=parseInt(ipfs[3],16),ipfs[4].length===2*length_4)return[2,"ipfs://"+basex_1.Base58.encode("0x"+ipfs[1])];return(swarm=hexBytes.match(/^0xe40101fa011b20([0-9a-f]*)$/))&&64===swarm[1].length?[2,"bzz://"+swarm[1]]:[2,logger.throwError("invalid or unsupported content hash data",logger_1.Logger.errors.UNSUPPORTED_OPERATION,
{operation:"getContentHash()",data:hexBytes})]}})})};Resolver.prototype.getText=function(key){return __awaiter(this,void 0,void 0,function(){var keyBytes,hexBytes;return __generator(this,function(_a){switch(_a.label){case 0:return keyBytes=strings_1.toUtf8Bytes(key),keyBytes=bytes_1.concat([bytes32ify(64),bytes32ify(keyBytes.length),keyBytes]),0!==keyBytes.length%32&&(keyBytes=bytes_1.concat([keyBytes,bytes_1.hexZeroPad("0x",32-key.length%32)])),[4,this._fetchBytes("0x59d1d43c",bytes_1.hexlify(keyBytes))];
case 1:return hexBytes=_a.sent(),null==hexBytes||"0x"===hexBytes?[2,null]:[2,strings_1.toUtf8String(hexBytes)]}})})};return Resolver}();exports.Resolver=Resolver;var defaultFormatter=null,nextPollId=1;require=function(_super){function BaseProvider(network){var _newTarget=this.constructor,_this=this;logger.checkNew(_newTarget,abstract_provider_1.Provider);_this=_super.call(this)||this;_this._events=[];_this._emitted={block:-2};_this.formatter=_newTarget.getFormatter();properties_1.defineReadOnly(_this,
"anyNetwork","any"===network);_this.anyNetwork&&(network=_this.detectNetwork());network instanceof Promise?(_this._networkPromise=network,network.catch(function(error){}),_this._ready().catch(function(error){})):(_newTarget=properties_1.getStatic(_newTarget,"getNetwork")(network))?(properties_1.defineReadOnly(_this,"_network",_newTarget),_this.emit("network",_newTarget,null)):logger.throwArgumentError("invalid network","network",network);_this._maxInternalBlockNumber=-1024;_this._lastBlockNumber=
-2;_this._pollingInterval=4E3;_this._fastQueryDate=0;return _this}__extends(BaseProvider,_super);BaseProvider.prototype._ready=function(){return __awaiter(this,void 0,void 0,function(){var network;return __generator(this,function(_a){switch(_a.label){case 0:if(null!=this._network)return[3,7];network=null;if(!this._networkPromise)return[3,4];_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this._networkPromise];case 2:return network=_a.sent(),[3,4];case 3:return _a.sent(),[3,4];case 4:return null!=
network?[3,6]:[4,this.detectNetwork()];case 5:network=_a.sent(),_a.label=6;case 6:network||logger.throwError("no network detected",logger_1.Logger.errors.UNKNOWN_ERROR,{}),null==this._network&&(this.anyNetwork?this._network=network:properties_1.defineReadOnly(this,"_network",network),this.emit("network",network,null)),_a.label=7;case 7:return[2,this._network]}})})};Object.defineProperty(BaseProvider.prototype,"ready",{get:function(){var _this=this;return web_1.poll(function(){return _this._ready().then(function(network){return network},
function(error){if(error.code!==logger_1.Logger.errors.NETWORK_ERROR||"noNetwork"!==error.event)throw error;})})},enumerable:!1,configurable:!0});BaseProvider.getFormatter=function(){null==defaultFormatter&&(defaultFormatter=new formatter_1.Formatter);return defaultFormatter};BaseProvider.getNetwork=function(network){return networks_1.getNetwork(null==network?"homestead":network)};BaseProvider.prototype._getInternalBlockNumber=function(maxAge){return __awaiter(this,void 0,void 0,function(){var internalBlockNumber,
result,reqTime,checkInternalBlockNumber,_this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return[4,this._ready()];case 1:_a$jscomp$0.sent();if(!(0<maxAge))return[3,7];_a$jscomp$0.label=2;case 2:if(!this._internalBlockNumber)return[3,7];internalBlockNumber=this._internalBlockNumber;_a$jscomp$0.label=3;case 3:return _a$jscomp$0.trys.push([3,5,,6]),[4,internalBlockNumber];case 4:return result=_a$jscomp$0.sent(),getTime()-result.respTime<=maxAge?[2,result.blockNumber]:
[3,7];case 5:return _a$jscomp$0.sent(),this._internalBlockNumber===internalBlockNumber?[3,7]:[3,6];case 6:return[3,2];case 7:return reqTime=getTime(),this._internalBlockNumber=checkInternalBlockNumber=properties_1.resolveProperties({blockNumber:this.perform("getBlockNumber",{}),networkError:this.getNetwork().then(function(network){return null},function(error){return error})}).then(function(_a){var blockNumber=_a.blockNumber;if(_a=_a.networkError)throw _this._internalBlockNumber===checkInternalBlockNumber&&
(_this._internalBlockNumber=null),_a;_a=getTime();blockNumber=bignumber_1.BigNumber.from(blockNumber).toNumber();blockNumber<_this._maxInternalBlockNumber&&(blockNumber=_this._maxInternalBlockNumber);_this._maxInternalBlockNumber=blockNumber;_this._setFastBlockNumber(blockNumber);return{blockNumber,reqTime,respTime:_a}}),checkInternalBlockNumber.catch(function(error){_this._internalBlockNumber===checkInternalBlockNumber&&(_this._internalBlockNumber=null)}),[4,checkInternalBlockNumber];case 8:return[2,
_a$jscomp$0.sent().blockNumber]}})})};BaseProvider.prototype.poll=function(){return __awaiter(this,void 0,void 0,function(){var pollId,runners,blockNumber,error_3,i,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:pollId=nextPollId++,runners=[],blockNumber=null,_a.label=1;case 1:return _a.trys.push([1,3,,4]),[4,this._getInternalBlockNumber(100+this.pollingInterval/2)];case 2:return blockNumber=_a.sent(),[3,4];case 3:return error_3=_a.sent(),this.emit("error",error_3),[2];case 4:this._setFastBlockNumber(blockNumber);
this.emit("poll",pollId,blockNumber);if(blockNumber===this._lastBlockNumber)return this.emit("didPoll",pollId),[2];-2===this._emitted.block&&(this._emitted.block=blockNumber-1);if(1E3<Math.abs(this._emitted.block-blockNumber))logger.warn("network block skew detected; skipping block events"),this.emit("error",logger.makeError("network block skew detected",logger_1.Logger.errors.NETWORK_ERROR,{blockNumber,event:"blockSkew",previousBlockNumber:this._emitted.block})),this.emit("block",blockNumber);else for(i=
this._emitted.block+1;i<=blockNumber;i++)this.emit("block",i);this._emitted.block!==blockNumber&&(this._emitted.block=blockNumber,Object.keys(this._emitted).forEach(function(key){if("block"!==key){var eventBlockNumber=_this._emitted[key];"pending"!==eventBlockNumber&&12<blockNumber-eventBlockNumber&&delete _this._emitted[key]}}));-2===this._lastBlockNumber&&(this._lastBlockNumber=blockNumber-1);this._events.forEach(function(event){switch(event.type){case "tx":var hash_2=event.hash;event=_this.getTransactionReceipt(hash_2).then(function(receipt){if(!receipt||
null==receipt.blockNumber)return null;_this._emitted["t:"+hash_2]=receipt.blockNumber;_this.emit(hash_2,receipt);return null}).catch(function(error){_this.emit("error",error)});runners.push(event);break;case "filter":var filter_1=event.filter;filter_1.fromBlock=_this._lastBlockNumber+1;filter_1.toBlock=blockNumber;event=_this.getLogs(filter_1).then(function(logs){0!==logs.length&&logs.forEach(function(log){_this._emitted["b:"+log.blockHash]=log.blockNumber;_this._emitted["t:"+log.transactionHash]=
log.blockNumber;_this.emit(filter_1,log)})}).catch(function(error){_this.emit("error",error)});runners.push(event)}});this._lastBlockNumber=blockNumber;Promise.all(runners).then(function(){_this.emit("didPoll",pollId)}).catch(function(error){_this.emit("error",error)});return[2]}})})};BaseProvider.prototype.resetEventsBlock=function(blockNumber){this._lastBlockNumber=blockNumber-1;this.polling&&this.poll()};Object.defineProperty(BaseProvider.prototype,"network",{get:function(){return this._network},
enumerable:!1,configurable:!0});BaseProvider.prototype.detectNetwork=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,logger.throwError("provider does not support network detection",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"provider.detectNetwork"})]})})};BaseProvider.prototype.getNetwork=function(){return __awaiter(this,void 0,void 0,function(){var network,currentNetwork,error;return __generator(this,function(_a){switch(_a.label){case 0:return[4,
this._ready()];case 1:return network=_a.sent(),[4,this.detectNetwork()];case 2:currentNetwork=_a.sent();if(network.chainId===currentNetwork.chainId)return[3,5];if(!this.anyNetwork)return[3,4];this._network=currentNetwork;this._lastBlockNumber=-2;this._fastBlockNumberPromise=this._fastBlockNumber=null;this._fastQueryDate=0;this._emitted.block=-2;this._maxInternalBlockNumber=-1024;this._internalBlockNumber=null;this.emit("network",currentNetwork,network);return[4,stall(0)];case 3:return _a.sent(),[2,
this._network];case 4:throw error=logger.makeError("underlying network changed",logger_1.Logger.errors.NETWORK_ERROR,{event:"changed",network,detectedNetwork:currentNetwork}),this.emit("error",error),error;case 5:return[2,network]}})})};Object.defineProperty(BaseProvider.prototype,"blockNumber",{get:function(){var _this=this;this._getInternalBlockNumber(100+this.pollingInterval/2).then(function(blockNumber){_this._setFastBlockNumber(blockNumber)},function(error){});return null!=this._fastBlockNumber?
this._fastBlockNumber:-1},enumerable:!1,configurable:!0});Object.defineProperty(BaseProvider.prototype,"polling",{get:function(){return null!=this._poller},set:function(value){var _this=this;value&&!this._poller?(this._poller=setInterval(function(){_this.poll()},this.pollingInterval),this._bootstrapPoll||(this._bootstrapPoll=setTimeout(function(){_this.poll();_this._bootstrapPoll=setTimeout(function(){_this._poller||_this.poll();_this._bootstrapPoll=null},_this.pollingInterval)},0))):!value&&this._poller&&
(clearInterval(this._poller),this._poller=null)},enumerable:!1,configurable:!0});Object.defineProperty(BaseProvider.prototype,"pollingInterval",{get:function(){return this._pollingInterval},set:function(value){var _this=this;if("number"!==typeof value||0>=value||parseInt(String(value))!=value)throw Error("invalid polling interval");this._pollingInterval=value;this._poller&&(clearInterval(this._poller),this._poller=setInterval(function(){_this.poll()},this._pollingInterval))},enumerable:!1,configurable:!0});
BaseProvider.prototype._getFastBlockNumber=function(){var _this=this,now=getTime();now-this._fastQueryDate>2*this._pollingInterval&&(this._fastQueryDate=now,this._fastBlockNumberPromise=this.getBlockNumber().then(function(blockNumber){if(null==_this._fastBlockNumber||blockNumber>_this._fastBlockNumber)_this._fastBlockNumber=blockNumber;return _this._fastBlockNumber}));return this._fastBlockNumberPromise};BaseProvider.prototype._setFastBlockNumber=function(blockNumber){!(null!=this._fastBlockNumber&&
blockNumber<this._fastBlockNumber)&&(this._fastQueryDate=getTime(),null==this._fastBlockNumber||blockNumber>this._fastBlockNumber)&&(this._fastBlockNumber=blockNumber,this._fastBlockNumberPromise=Promise.resolve(blockNumber))};BaseProvider.prototype.waitForTransaction=function(transactionHash,confirmations,timeout){return __awaiter(this,void 0,void 0,function(){var receipt$jscomp$0,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return null==confirmations&&(confirmations=1),
[4,this.getTransactionReceipt(transactionHash)];case 1:return receipt$jscomp$0=_a.sent(),(receipt$jscomp$0?receipt$jscomp$0.confirmations:0)>=confirmations?[2,receipt$jscomp$0]:[2,new Promise(function(resolve,reject){var timer=null,done=!1,handler=function(receipt){receipt.confirmations<confirmations||(timer&&clearTimeout(timer),done||(done=!0,_this.removeListener(transactionHash,handler),resolve(receipt)))};_this.on(transactionHash,handler);"number"===typeof timeout&&0<timeout&&(timer=setTimeout(function(){done||
(timer=null,done=!0,_this.removeListener(transactionHash,handler),reject(logger.makeError("timeout exceeded",logger_1.Logger.errors.TIMEOUT,{timeout})))},timeout),timer.unref&&timer.unref())})]}})})};BaseProvider.prototype.getBlockNumber=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this._getInternalBlockNumber(0)]})})};BaseProvider.prototype.getGasPrice=function(){return __awaiter(this,void 0,void 0,function(){var result;return __generator(this,
function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,this.perform("getGasPrice",{})];case 2:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getGasPrice",result,error})]}}})})};BaseProvider.prototype.getBalance=function(addressOrName,blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,
this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag)})];case 2:return params=_a.sent(),[4,this.perform("getBalance",params)];case 3:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getBalance",params,result,error})]}}})})};BaseProvider.prototype.getTransactionCount=function(addressOrName,
blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag)})];case 2:return params=_a.sent(),[4,this.perform("getTransactionCount",params)];case 3:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result).toNumber()]}catch(error){return[2,logger.throwError("bad result from backend",
logger_1.Logger.errors.SERVER_ERROR,{method:"getTransactionCount",params,result,error})]}}})})};BaseProvider.prototype.getCode=function(addressOrName,blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({address:this._getAddress(addressOrName),blockTag:this._getBlockTag(blockTag)})];case 2:return params=_a.sent(),[4,this.perform("getCode",
params)];case 3:result=_a.sent();try{return[2,bytes_1.hexlify(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getCode",params,result,error})]}}})})};BaseProvider.prototype.getStorageAt=function(addressOrName,position,blockTag){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({address:this._getAddress(addressOrName),
blockTag:this._getBlockTag(blockTag),position:Promise.resolve(position).then(function(p){return bytes_1.hexValue(p)})})];case 2:return params=_a.sent(),[4,this.perform("getStorageAt",params)];case 3:result=_a.sent();try{return[2,bytes_1.hexlify(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"getStorageAt",params,result,error})]}}})})};BaseProvider.prototype._wrapTransaction=function(tx,hash){var _this=this;if(null!=hash&&32!==
bytes_1.hexDataLength(hash))throw Error("invalid response - sendTransaction");null!=hash&&tx.hash!==hash&&logger.throwError("Transaction hash mismatch from Provider.sendTransaction.",logger_1.Logger.errors.UNKNOWN_ERROR,{expectedHash:tx.hash,returnedHash:hash});tx.wait=function(confirmations){return __awaiter(_this,void 0,void 0,function(){var receipt;return __generator(this,function(_a){switch(_a.label){case 0:return 0!==confirmations&&(this._emitted["t:"+tx.hash]="pending"),[4,this.waitForTransaction(tx.hash,
confirmations)];case 1:receipt=_a.sent();if(null==receipt&&0===confirmations)return[2,null];this._emitted["t:"+tx.hash]=receipt.blockNumber;0===receipt.status&&logger.throwError("transaction failed",logger_1.Logger.errors.CALL_EXCEPTION,{transactionHash:tx.hash,transaction:tx,receipt});return[2,receipt]}})})};return tx};BaseProvider.prototype.sendTransaction=function(signedTransaction){return __awaiter(this,void 0,void 0,function(){var hexTx,tx,hash,error_4;return __generator(this,function(_a){switch(_a.label){case 0:return[4,
this.getNetwork()];case 1:return _a.sent(),[4,Promise.resolve(signedTransaction).then(function(t){return bytes_1.hexlify(t)})];case 2:hexTx=_a.sent(),tx=this.formatter.transaction(signedTransaction),_a.label=3;case 3:return _a.trys.push([3,5,,6]),[4,this.perform("sendTransaction",{signedTransaction:hexTx})];case 4:return hash=_a.sent(),[2,this._wrapTransaction(tx,hash)];case 5:throw error_4=_a.sent(),error_4.transaction=tx,error_4.transactionHash=tx.hash,error_4;case 6:return[2]}})})};BaseProvider.prototype._getTransactionRequest=
function(transaction){return __awaiter(this,void 0,void 0,function(){var values,tx,_a,_b,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return[4,transaction];case 1:return values=_c.sent(),tx={},["from","to"].forEach(function(key){null!=values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return v?_this._getAddress(v):null}))}),["gasLimit","gasPrice","value"].forEach(function(key){null!=values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return v?
bignumber_1.BigNumber.from(v):null}))}),["data"].forEach(function(key){null!=values[key]&&(tx[key]=Promise.resolve(values[key]).then(function(v){return v?bytes_1.hexlify(v):null}))}),_b=(_a=this.formatter).transactionRequest,[4,properties_1.resolveProperties(tx)];case 2:return[2,_b.apply(_a,[_c.sent()])]}})})};BaseProvider.prototype._getFilter=function(filter){return __awaiter(this,void 0,void 0,function(){var result,_a,_b,_this=this;return __generator(this,function(_c){switch(_c.label){case 0:return[4,
filter];case 1:return filter=_c.sent(),result={},null!=filter.address&&(result.address=this._getAddress(filter.address)),["blockHash","topics"].forEach(function(key){null!=filter[key]&&(result[key]=filter[key])}),["fromBlock","toBlock"].forEach(function(key){null!=filter[key]&&(result[key]=_this._getBlockTag(filter[key]))}),_b=(_a=this.formatter).filter,[4,properties_1.resolveProperties(result)];case 2:return[2,_b.apply(_a,[_c.sent()])]}})})};BaseProvider.prototype.call=function(transaction,blockTag){return __awaiter(this,
void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({transaction:this._getTransactionRequest(transaction),blockTag:this._getBlockTag(blockTag)})];case 2:return params=_a.sent(),[4,this.perform("call",params)];case 3:result=_a.sent();try{return[2,bytes_1.hexlify(result)]}catch(error){return[2,logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,
{method:"call",params,result,error})]}}})})};BaseProvider.prototype.estimateGas=function(transaction){return __awaiter(this,void 0,void 0,function(){var params,result;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({transaction:this._getTransactionRequest(transaction)})];case 2:return params=_a.sent(),[4,this.perform("estimateGas",params)];case 3:result=_a.sent();try{return[2,bignumber_1.BigNumber.from(result)]}catch(error){return[2,
logger.throwError("bad result from backend",logger_1.Logger.errors.SERVER_ERROR,{method:"estimateGas",params,result,error})]}}})})};BaseProvider.prototype._getAddress=function(addressOrName){return __awaiter(this,void 0,void 0,function(){var address;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.resolveName(addressOrName)];case 1:return address=_a.sent(),null==address&&logger.throwError("ENS name not configured",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"resolveName("+
JSON.stringify(addressOrName)+")"}),[2,address]}})})};BaseProvider.prototype._getBlock=function(blockHashOrBlockTag,includeTransactions){return __awaiter(this,void 0,void 0,function(){var blockNumber,params,_a$jscomp$0,_b,_c,_this=this;return __generator(this,function(_d){switch(_d.label){case 0:return[4,this.getNetwork()];case 1:return _d.sent(),[4,blockHashOrBlockTag];case 2:blockHashOrBlockTag=_d.sent();blockNumber=-128;params={includeTransactions:!!includeTransactions};if(!bytes_1.isHexString(blockHashOrBlockTag,
32))return[3,3];params.blockHash=blockHashOrBlockTag;return[3,6];case 3:return _d.trys.push([3,5,,6]),_a$jscomp$0=params,_c=(_b=this.formatter).blockTag,[4,this._getBlockTag(blockHashOrBlockTag)];case 4:return _a$jscomp$0.blockTag=_c.apply(_b,[_d.sent()]),bytes_1.isHexString(params.blockTag)&&(blockNumber=parseInt(params.blockTag.substring(2),16)),[3,6];case 5:return _d.sent(),logger.throwArgumentError("invalid block hash or block tag","blockHashOrBlockTag",blockHashOrBlockTag),[3,6];case 6:return[2,
web_1.poll(function(){return __awaiter(_this,void 0,void 0,function(){var block,blockNumber_1,i,tx,confirmations;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.perform("getBlock",params)];case 1:block=_a.sent();if(null==block)return null!=params.blockHash&&null==this._emitted["b:"+params.blockHash]||null!=params.blockTag&&blockNumber>this._emitted.block?[2,null]:[2,void 0];if(!includeTransactions)return[3,8];blockNumber_1=null;i=0;_a.label=2;case 2:if(!(i<block.transactions.length))return[3,
7];tx=block.transactions[i];if(null!=tx.blockNumber)return[3,3];tx.confirmations=0;return[3,6];case 3:return null!=tx.confirmations?[3,6]:null!=blockNumber_1?[3,5]:[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 4:blockNumber_1=_a.sent(),_a.label=5;case 5:confirmations=blockNumber_1-tx.blockNumber+1,0>=confirmations&&(confirmations=1),tx.confirmations=confirmations,_a.label=6;case 6:return i++,[3,2];case 7:return[2,this.formatter.blockWithTransactions(block)];case 8:return[2,this.formatter.block(block)]}})})},
{oncePoll:this})]}})})};BaseProvider.prototype.getBlock=function(blockHashOrBlockTag){return this._getBlock(blockHashOrBlockTag,!1)};BaseProvider.prototype.getBlockWithTransactions=function(blockHashOrBlockTag){return this._getBlock(blockHashOrBlockTag,!0)};BaseProvider.prototype.getTransaction=function(transactionHash){return __awaiter(this,void 0,void 0,function(){var params,_this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return[4,this.getNetwork()];case 1:return _a$jscomp$0.sent(),
[4,transactionHash];case 2:return transactionHash=_a$jscomp$0.sent(),params={transactionHash:this.formatter.hash(transactionHash,!0)},[2,web_1.poll(function(){return __awaiter(_this,void 0,void 0,function(){var result,tx,blockNumber,confirmations;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.perform("getTransaction",params)];case 1:result=_a.sent();if(null==result)return null==this._emitted["t:"+transactionHash]?[2,null]:[2,void 0];tx=this.formatter.transactionResponse(result);
if(null!=tx.blockNumber)return[3,2];tx.confirmations=0;return[3,4];case 2:return null!=tx.confirmations?[3,4]:[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 3:blockNumber=_a.sent(),confirmations=blockNumber-tx.blockNumber+1,0>=confirmations&&(confirmations=1),tx.confirmations=confirmations,_a.label=4;case 4:return[2,this._wrapTransaction(tx)]}})})},{oncePoll:this})]}})})};BaseProvider.prototype.getTransactionReceipt=function(transactionHash){return __awaiter(this,void 0,void 0,
function(){var params,_this=this;return __generator(this,function(_a$jscomp$0){switch(_a$jscomp$0.label){case 0:return[4,this.getNetwork()];case 1:return _a$jscomp$0.sent(),[4,transactionHash];case 2:return transactionHash=_a$jscomp$0.sent(),params={transactionHash:this.formatter.hash(transactionHash,!0)},[2,web_1.poll(function(){return __awaiter(_this,void 0,void 0,function(){var result,receipt,blockNumber,confirmations;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.perform("getTransactionReceipt",
params)];case 1:result=_a.sent();if(null==result)return null==this._emitted["t:"+transactionHash]?[2,null]:[2,void 0];if(null==result.blockHash)return[2,void 0];receipt=this.formatter.receipt(result);if(null!=receipt.blockNumber)return[3,2];receipt.confirmations=0;return[3,4];case 2:return null!=receipt.confirmations?[3,4]:[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 3:blockNumber=_a.sent(),confirmations=blockNumber-receipt.blockNumber+1,0>=confirmations&&(confirmations=1),receipt.confirmations=
confirmations,_a.label=4;case 4:return[2,receipt]}})})},{oncePoll:this})]}})})};BaseProvider.prototype.getLogs=function(filter){return __awaiter(this,void 0,void 0,function(){var params,logs;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[4,properties_1.resolveProperties({filter:this._getFilter(filter)})];case 2:return params=_a.sent(),[4,this.perform("getLogs",params)];case 3:return logs=_a.sent(),logs.forEach(function(log){null==
log.removed&&(log.removed=!1)}),[2,formatter_1.Formatter.arrayOf(this.formatter.filterLog.bind(this.formatter))(logs)]}})})};BaseProvider.prototype.getEtherPrice=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getNetwork()];case 1:return _a.sent(),[2,this.perform("getEtherPrice",{})]}})})};BaseProvider.prototype._getBlockTag=function(blockTag){return __awaiter(this,void 0,void 0,function(){var blockNumber;return __generator(this,
function(_a){switch(_a.label){case 0:return[4,blockTag];case 1:blockTag=_a.sent();if(!("number"===typeof blockTag&&0>blockTag))return[3,3];blockTag%1&&logger.throwArgumentError("invalid BlockTag","blockTag",blockTag);return[4,this._getInternalBlockNumber(100+2*this.pollingInterval)];case 2:return blockNumber=_a.sent(),blockNumber+=blockTag,0>blockNumber&&(blockNumber=0),[2,this.formatter.blockTag(blockNumber)];case 3:return[2,this.formatter.blockTag(blockTag)]}})})};BaseProvider.prototype.getResolver=
function(name){return __awaiter(this,void 0,void 0,function(){var address;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this._getResolver(name)];case 1:return address=_a.sent(),null==address?[2,null]:[2,new Resolver(this,address,name)]}})})};BaseProvider.prototype._getResolver=function(name){return __awaiter(this,void 0,void 0,function(){var network,transaction,_a,_b;return __generator(this,function(_c){switch(_c.label){case 0:return[4,this.getNetwork()];case 1:return network=
_c.sent(),network.ensAddress||logger.throwError("network does not support ENS",logger_1.Logger.errors.UNSUPPORTED_OPERATION,{operation:"ENS",network:network.name}),transaction={to:network.ensAddress,data:"0x0178b8bf"+hash_1.namehash(name).substring(2)},_b=(_a=this.formatter).callAddress,[4,this.call(transaction)];case 2:return[2,_b.apply(_a,[_c.sent()])]}})})};BaseProvider.prototype.resolveName=function(name){return __awaiter(this,void 0,void 0,function(){var resolver;return __generator(this,function(_a){switch(_a.label){case 0:return[4,
name];case 1:name=_a.sent();try{return[2,Promise.resolve(this.formatter.address(name))]}catch(error){if(bytes_1.isHexString(name))throw error;}"string"!==typeof name&&logger.throwArgumentError("invalid ENS name","name",name);return[4,this.getResolver(name)];case 2:return(resolver=_a.sent())?[4,resolver.getAddress()]:[2,null];case 3:return[2,_a.sent()]}})})};BaseProvider.prototype.lookupAddress=function(address){return __awaiter(this,void 0,void 0,function(){var reverseName,resolverAddress,bytes,_a,
length,name,addr;return __generator(this,function(_b){switch(_b.label){case 0:return[4,address];case 1:return address=_b.sent(),address=this.formatter.address(address),reverseName=address.substring(2).toLowerCase()+".addr.reverse",[4,this._getResolver(reverseName)];case 2:resolverAddress=_b.sent();if(!resolverAddress)return[2,null];_a=bytes_1.arrayify;return[4,this.call({to:resolverAddress,data:"0x691f3431"+hash_1.namehash(reverseName).substring(2)})];case 3:bytes=_a.apply(void 0,[_b.sent()]);if(32>
bytes.length||!bignumber_1.BigNumber.from(bytes.slice(0,32)).eq(32))return[2,null];bytes=bytes.slice(32);if(32>bytes.length)return[2,null];length=bignumber_1.BigNumber.from(bytes.slice(0,32)).toNumber();bytes=bytes.slice(32);if(length>bytes.length)return[2,null];name=strings_1.toUtf8String(bytes.slice(0,length));return[4,this.resolveName(name)];case 4:return addr=_b.sent(),addr!=address?[2,null]:[2,name]}})})};BaseProvider.prototype.perform=function(method,params){return logger.throwError(method+
" not implemented",logger_1.Logger.errors.NOT_IMPLEMENTED,{operation:method})};BaseProvider.prototype._startEvent=function(event){this.polling=0<this._events.filter(function(e){return e.pollable()}).length};BaseProvider.prototype._stopEvent=function(event){this.polling=0<this._events.filter(function(e){return e.pollable()}).length};BaseProvider.prototype._addEventListener=function(eventName,listener,once){eventName=new Event$jscomp$0(getEventTag(eventName),listener,once);this._events.push(eventName);
this._startEvent(eventName);return this};BaseProvider.prototype.on=function(eventName,listener){return this._addEventListener(eventName,listener,!1)};BaseProvider.prototype.once=function(eventName,listener){return this._addEventListener(eventName,listener,!0)};BaseProvider.prototype.emit=function(eventName){for(var _this=this,args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var result=!1,stopped=[],eventTag=getEventTag(eventName);this._events=this._events.filter(function(event){if(event.tag!==
eventTag)return!0;setTimeout(function(){event.listener.apply(_this,args)},0);result=!0;return event.once?(stopped.push(event),!1):!0});stopped.forEach(function(event){_this._stopEvent(event)});return result};BaseProvider.prototype.listenerCount=function(eventName){if(!eventName)return this._events.length;var eventTag=getEventTag(eventName);return this._events.filter(function(event){return event.tag===eventTag}).length};BaseProvider.prototype.listeners=function(eventName){if(null==eventName)return this._events.map(function(event){return event.listener});
var eventTag=getEventTag(eventName);return this._events.filter(function(event){return event.tag===eventTag}).map(function(event){return event.listener})};BaseProvider.prototype.off=function(eventName,listener){var _this=this;if(null==listener)return this.removeAllListeners(eventName);var stopped=[],found=!1,eventTag=getEventTag(eventName);this._events=this._events.filter(function(event){if(event.tag!==eventTag||event.listener!=listener||found)return!0;found=!0;stopped.push(event);return!1});stopped.forEach(function(event){_this._stopEvent(event)});
return this};BaseProvider.prototype.removeAllListeners=function(eventName){var _this=this,stopped=[];if(null==eventName)stopped=this._events,this._events=[];else{var eventTag_1=getEventTag(eventName);this._events=this._events.filter(function(event){if(event.tag!==eventTag_1)return!0;stopped.push(event);return!1})}stopped.forEach(function(event){_this._stopEvent(event)});return this};return BaseProvider}(abstract_provider_1.Provider);exports.BaseProvider=require}
//# sourceMappingURL=module$node_modules$$ethersproject$providers$lib$base_provider.js.map
