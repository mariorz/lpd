shadow$provide.module$node_modules$web3_provider_engine$dist$es5$subproviders$nonce_tracker=function(global,require,module,exports){function NonceTrackerSubprovider(opts){this.nonceCache={}}var Buffer=require("module$node_modules$buffer$index").Buffer;"use strict";global=require("module$node_modules$util$util").inherits;var Transaction=require("module$node_modules$ethereumjs_tx$es5$index"),ethUtil=require("module$node_modules$ethereumjs_util$dist$index");exports=require("module$node_modules$web3_provider_engine$dist$es5$subproviders$subprovider");
var blockTagForPayload=require("module$node_modules$web3_provider_engine$dist$es5$util$rpc_cache_utils").blockTagForPayload;module.exports=NonceTrackerSubprovider;global(NonceTrackerSubprovider,exports);NonceTrackerSubprovider.prototype.handleRequest=function(payload,next,end){var self=this;switch(payload.method){case "eth_getTransactionCount":var blockTag=blockTagForPayload(payload),address=payload.params[0].toLowerCase(),cachedResult=self.nonceCache[address];"pending"===blockTag?cachedResult?end(null,
cachedResult):next(function(err,result,cb){if(err)return cb();void 0===self.nonceCache[address]&&(self.nonceCache[address]=result);cb()}):next();break;case "eth_sendRawTransaction":next(function(err,result,cb){if(err)return cb();err=payload.params[0];ethUtil.stripHexPrefix(err);Buffer.from(ethUtil.stripHexPrefix(err),"hex");result=new Transaction(Buffer.from(ethUtil.stripHexPrefix(err),"hex"));err="0x"+result.getSenderAddress().toString("hex").toLowerCase();result=ethUtil.bufferToInt(result.nonce);
result++;result=result.toString(16);result.length%2&&(result="0"+result);self.nonceCache[err]="0x"+result;cb()});break;case "evm_revert":self.nonceCache={};next();break;default:next()}}}
//# sourceMappingURL=module$node_modules$web3_provider_engine$dist$es5$subproviders$nonce_tracker.js.map
