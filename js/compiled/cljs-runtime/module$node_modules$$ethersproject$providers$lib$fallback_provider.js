shadow$provide.module$node_modules$$ethersproject$providers$lib$fallback_provider=function(global,require,module,exports){function checkNetworks(networks){for(var result=null,i=0;i<networks.length;i++){var network=networks[i];if(null==network)return null;result?(result.name!==network.name||result.chainId!==network.chainId||result.ensAddress!==network.ensAddress&&(null!=result.ensAddress||null!=network.ensAddress))&&logger.throwArgumentError("provider mismatch","networks",networks):result=network}return result}
function median(values,maxDelta){values=values.slice().sort();var middle=Math.floor(values.length/2);if(values.length%2)return values[middle];var a=values[middle-1];values=values[middle];return null!=maxDelta&&Math.abs(a-values)>maxDelta?null:(a+values)/2}function serialize(value){if(null===value)return"null";if("number"===typeof value||"boolean"===typeof value)return JSON.stringify(value);if("string"===typeof value)return value;if(bignumber_1.BigNumber.isBigNumber(value))return value.toString();
if(Array.isArray(value))return JSON.stringify(value.map(function(i){return serialize(i)}));if("object"===typeof value){var keys=Object.keys(value);keys.sort();return"{"+keys.map(function(key){var v=value[key];v="function"===typeof v?"[function]":serialize(v);return JSON.stringify(key)+":"+v}).join(",")+"}"}throw Error("unknown value type: "+typeof value);}function stall(duration){var cancel=null,timer=null,promise=new Promise(function(resolve){cancel=function(){timer&&(clearTimeout(timer),timer=null);
resolve()};timer=setTimeout(cancel,duration)});return{cancel,getPromise:function(){return promise},wait:function(func){return promise=promise.then(func)}}}function exposeDebugConfig(config,now){var result={weight:config.weight};Object.defineProperty(result,"provider",{get:function(){return config.provider}});config.start&&(result.start=config.start);now&&(result.duration=now-config.start);config.done&&(config.error?result.error=config.error:result.result=config.result||null);return result}function normalizedTally(normalize,
quorum){return function(configs){var tally={};configs.forEach(function(c){var value=normalize(c.result);tally[value]||(tally[value]={count:0,result:c.result});tally[value].count++});configs=Object.keys(tally);for(var i=0;i<configs.length;i++){var check=tally[configs[i]];if(check.count>=quorum)return check.result}}}function getProcessFunc(provider,method,params){var normalize=serialize;switch(method){case "getBlockNumber":return function(configs){var values=configs.map(function(c){return c.result});
configs=median(configs.map(function(c){return c.result}),2);if(null!=configs)return configs=Math.ceil(configs),0<=values.indexOf(configs+1)&&configs++,configs>=provider._highestBlockNumber&&(provider._highestBlockNumber=configs),provider._highestBlockNumber};case "getGasPrice":return function(configs){configs=configs.map(function(c){return c.result});configs.sort();return configs[Math.floor(configs.length/2)]};case "getEtherPrice":return function(configs){return median(configs.map(function(c){return c.result}))};
case "getBalance":case "getTransactionCount":case "getCode":case "getStorageAt":case "call":case "estimateGas":case "getLogs":break;case "getTransaction":case "getTransactionReceipt":normalize=function(tx){if(null==tx)return null;tx=properties_1.shallowCopy(tx);tx.confirmations=-1;return serialize(tx)};break;case "getBlock":normalize=params.includeTransactions?function(block){if(null==block)return null;block=properties_1.shallowCopy(block);block.transactions=block.transactions.map(function(tx){tx=
properties_1.shallowCopy(tx);tx.confirmations=-1;return tx});return serialize(block)}:function(block){return null==block?null:serialize(block)};break;default:throw Error("unknown method: "+method);}return normalizedTally(normalize,provider.quorum)}function waitForSync(config,blockNumber){return __awaiter(this,void 0,void 0,function(){var provider;return __generator(this,function(_a){provider=config.provider;return null!=provider.blockNumber&&provider.blockNumber>=blockNumber||-1===blockNumber?[2,
provider]:[2,web_1.poll(function(){return new Promise(function(resolve,reject){setTimeout(function(){return provider.blockNumber>=blockNumber?resolve(provider):config.cancelled?resolve(null):resolve(void 0)},0)})},{oncePoll:provider})]})})}function getRunner(config,currentBlockNumber,method,params){return __awaiter(this,void 0,void 0,function(){var provider,_a,filter;return __generator(this,function(_b){switch(_b.label){case 0:provider=config.provider;_a=method;switch(_a){case "getBlockNumber":return[3,
1];case "getGasPrice":return[3,1];case "getEtherPrice":return[3,2];case "getBalance":return[3,3];case "getTransactionCount":return[3,3];case "getCode":return[3,3];case "getStorageAt":return[3,6];case "getBlock":return[3,9];case "call":return[3,12];case "estimateGas":return[3,12];case "getTransaction":return[3,15];case "getTransactionReceipt":return[3,15];case "getLogs":return[3,16]}return[3,19];case 1:return[2,provider[method]()];case 2:return provider.getEtherPrice?[2,provider.getEtherPrice()]:[3,
19];case 3:return params.blockTag&&bytes_1.isHexString(params.blockTag)?[4,waitForSync(config,currentBlockNumber)]:[3,5];case 4:provider=_b.sent(),_b.label=5;case 5:return[2,provider[method](params.address,params.blockTag||"latest")];case 6:return params.blockTag&&bytes_1.isHexString(params.blockTag)?[4,waitForSync(config,currentBlockNumber)]:[3,8];case 7:provider=_b.sent(),_b.label=8;case 8:return[2,provider.getStorageAt(params.address,params.position,params.blockTag||"latest")];case 9:return params.blockTag&&
bytes_1.isHexString(params.blockTag)?[4,waitForSync(config,currentBlockNumber)]:[3,11];case 10:provider=_b.sent(),_b.label=11;case 11:return[2,provider[params.includeTransactions?"getBlockWithTransactions":"getBlock"](params.blockTag||params.blockHash)];case 12:return params.blockTag&&bytes_1.isHexString(params.blockTag)?[4,waitForSync(config,currentBlockNumber)]:[3,14];case 13:provider=_b.sent(),_b.label=14;case 14:return[2,provider[method](params.transaction)];case 15:return[2,provider[method](params.transactionHash)];
case 16:return filter=params.filter,filter.fromBlock&&bytes_1.isHexString(filter.fromBlock)||filter.toBlock&&bytes_1.isHexString(filter.toBlock)?[4,waitForSync(config,currentBlockNumber)]:[3,18];case 17:provider=_b.sent(),_b.label=18;case 18:return[2,provider.getLogs(filter)];case 19:return[2,logger.throwError("unknown method error",logger_1.Logger.errors.UNKNOWN_ERROR,{method,params})]}})})}var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=
Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__awaiter=this&&
this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,
_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=
[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&
1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});exports.FallbackProvider=void 0;var abstract_provider_1=require("module$node_modules$$ethersproject$abstract_provider$lib$index"),bignumber_1=require("module$node_modules$$ethersproject$bignumber$lib$index"),bytes_1=require("module$node_modules$$ethersproject$bytes$lib$index"),
properties_1=require("module$node_modules$$ethersproject$properties$lib$index"),random_1=require("module$node_modules$$ethersproject$random$lib$index"),web_1=require("module$node_modules$$ethersproject$web$lib$index");global=require("module$node_modules$$ethersproject$providers$lib$base_provider");var formatter_1=require("module$node_modules$$ethersproject$providers$lib$formatter"),logger_1=require("module$node_modules$$ethersproject$logger$lib$index");require=require("module$node_modules$$ethersproject$providers$lib$_version");
var logger=new logger_1.Logger(require.version),nextRid=1,ForwardErrors=[logger_1.Logger.errors.CALL_EXCEPTION,logger_1.Logger.errors.INSUFFICIENT_FUNDS,logger_1.Logger.errors.NONCE_EXPIRED,logger_1.Logger.errors.REPLACEMENT_UNDERPRICED,logger_1.Logger.errors.UNPREDICTABLE_GAS_LIMIT],ForwardProperties="address args errorArgs errorSignature method transaction".split(" ");require=function(_super){function FallbackProvider(providers,quorum){var _this=this;logger.checkNew(this.constructor,FallbackProvider);
0===providers.length&&logger.throwArgumentError("missing providers","providers",providers);providers=providers.map(function(configOrProvider,index){if(abstract_provider_1.Provider.isProvider(configOrProvider))return index=formatter_1.isCommunityResource(configOrProvider)?2E3:750,Object.freeze({provider:configOrProvider,weight:1,stallTimeout:index,priority:1});var config=properties_1.shallowCopy(configOrProvider);null==config.priority&&(config.priority=1);null==config.stallTimeout&&(config.stallTimeout=
formatter_1.isCommunityResource(configOrProvider)?2E3:750);null==config.weight&&(config.weight=1);configOrProvider=config.weight;(configOrProvider%1||512<configOrProvider||1>configOrProvider)&&logger.throwArgumentError("invalid weight; must be integer in [1, 512]","providers["+index+"].weight",configOrProvider);return Object.freeze(config)});var total=providers.reduce(function(accum,c){return accum+c.weight},0);null==quorum?quorum=total/2:quorum>total&&logger.throwArgumentError("quorum will always fail; larger than total weight",
"quorum",quorum);total=checkNetworks(providers.map(function(c){return c.provider.network}));null==total&&(total=new Promise(function(resolve,reject){setTimeout(function(){_this.detectNetwork().then(resolve,reject)},0)}));_this=_super.call(this,total)||this;properties_1.defineReadOnly(_this,"providerConfigs",Object.freeze(providers));properties_1.defineReadOnly(_this,"quorum",quorum);_this._highestBlockNumber=-1;return _this}__extends(FallbackProvider,_super);FallbackProvider.prototype.detectNetwork=
function(){return __awaiter(this,void 0,void 0,function(){var networks;return __generator(this,function(_a){switch(_a.label){case 0:return[4,Promise.all(this.providerConfigs.map(function(c){return c.provider.getNetwork()}))];case 1:return networks=_a.sent(),[2,checkNetworks(networks)]}})})};FallbackProvider.prototype.perform=function(method,params){return __awaiter(this,void 0,void 0,function(){var results$jscomp$0,i_1,result$jscomp$1,processFunc,configs,currentBlockNumber,i,first,_loop_1,this_1,
state_1,_this=this;return __generator(this,function(_a){switch(_a.label){case 0:return"sendTransaction"!==method?[3,2]:[4,Promise.all(this.providerConfigs.map(function(c){return c.provider.sendTransaction(params.signedTransaction).then(function(result){return result.hash},function(error){return error})}))];case 1:results$jscomp$0=_a.sent();for(i_1=0;i_1<results$jscomp$0.length;i_1++)if(result$jscomp$1=results$jscomp$0[i_1],"string"===typeof result$jscomp$1)return[2,result$jscomp$1];throw results$jscomp$0[0];
case 2:return-1!==this._highestBlockNumber||"getBlockNumber"===method?[3,4]:[4,this.getBlockNumber()];case 3:_a.sent(),_a.label=4;case 4:processFunc=getProcessFunc(this,method,params),configs=random_1.shuffled(this.providerConfigs.map(properties_1.shallowCopy)),configs.sort(function(a,b){return a.priority-b.priority}),currentBlockNumber=this._highestBlockNumber,i=0,first=!0,_loop_1=function(){var t0,inflightWeight,_loop_2,waiting,results,result$jscomp$0,errors;return __generator(this,function(_b){switch(_b.label){case 0:t0=
(new Date).getTime();inflightWeight=configs.filter(function(c){return c.runner&&t0-c.start<c.stallTimeout}).reduce(function(accum,c){return accum+c.weight},0);for(_loop_2=function(){var config=configs[i++],rid=nextRid++;config.start=(new Date).getTime();config.staller=stall(config.stallTimeout);config.staller.wait(function(){config.staller=null});config.runner=getRunner(config,currentBlockNumber,method,params).then(function(result){config.done=!0;config.result=result;_this.listenerCount("debug")&&
_this.emit("debug",{action:"request",rid,backend:exposeDebugConfig(config,(new Date).getTime()),request:{method,params:properties_1.deepCopy(params)},provider:_this})},function(error){config.done=!0;config.error=error;_this.listenerCount("debug")&&_this.emit("debug",{action:"request",rid,backend:exposeDebugConfig(config,(new Date).getTime()),request:{method,params:properties_1.deepCopy(params)},provider:_this})});this_1.listenerCount("debug")&&this_1.emit("debug",{action:"request",rid,backend:exposeDebugConfig(config,
null),request:{method,params:properties_1.deepCopy(params)},provider:this_1});inflightWeight+=config.weight};inflightWeight<this_1.quorum&&i<configs.length;)_loop_2();waiting=[];configs.forEach(function(c){!c.done&&c.runner&&(waiting.push(c.runner),c.staller&&waiting.push(c.staller.getPromise()))});return waiting.length?[4,Promise.race(waiting)]:[3,2];case 1:_b.sent(),_b.label=2;case 2:results=configs.filter(function(c){return c.done&&null==c.error});if(!(results.length>=this_1.quorum))return[3,5];
result$jscomp$0=processFunc(results);return void 0!==result$jscomp$0?(configs.forEach(function(c){c.staller&&c.staller.cancel();c.cancelled=!0}),[2,{value:result$jscomp$0}]):first?[3,4]:[4,stall(100).getPromise()];case 3:_b.sent(),_b.label=4;case 4:first=!1,_b.label=5;case 5:return errors=configs.reduce(function(accum,c){if(!c.done||null==c.error)return accum;var code=c.error.code;0<=ForwardErrors.indexOf(code)&&(accum[code]||(accum[code]={error:c.error,weight:0}),accum[code].weight+=c.weight);return accum},
{}),Object.keys(errors).forEach(function(errorCode){var tally=errors[errorCode];if(!(tally.weight<_this.quorum)){configs.forEach(function(c){c.staller&&c.staller.cancel();c.cancelled=!0});var e=tally.error,props={};ForwardProperties.forEach(function(name){null!=e[name]&&(props[name]=e[name])});logger.throwError(e.reason||e.message,errorCode,props)}}),0===configs.filter(function(c){return!c.done}).length?[2,"break"]:[2]}})},this_1=this,_a.label=5;case 5:return[5,_loop_1()];case 6:return state_1=_a.sent(),
"object"===typeof state_1?[2,state_1.value]:"break"===state_1?[3,7]:[3,5];case 7:return configs.forEach(function(c){c.staller&&c.staller.cancel();c.cancelled=!0}),[2,logger.throwError("failed to meet quorum",logger_1.Logger.errors.SERVER_ERROR,{method,params,results:configs.map(function(c){return exposeDebugConfig(c)}),provider:this})]}})})};return FallbackProvider}(global.BaseProvider);exports.FallbackProvider=require}
//# sourceMappingURL=module$node_modules$$ethersproject$providers$lib$fallback_provider.js.map
