shadow$provide.module$node_modules$web3_provider_engine$index=function(global,require,module,exports){function Web3ProviderEngine(opts){EventEmitter.call(this);this.setMaxListeners(30);opts=opts||{};var directProvider={sendAsync:this._handleAsync.bind(this)};directProvider=opts.blockTrackerProvider||directProvider;this._blockTracker=opts.blockTracker||new EthBlockTracker({provider:directProvider,pollingInterval:opts.pollingInterval||4E3,setSkipCacheFlag:!0});this._ready=new Stoplight;this.currentBlock=
null;this._providers=[]}const EventEmitter=require("module$node_modules$events$events").EventEmitter;global=require("module$node_modules$util$util").inherits;const ethUtil=require("module$node_modules$ethereumjs_util$dist$index"),EthBlockTracker=require("module$node_modules$eth_block_tracker$src$polling"),map=require("module$node_modules$async$map"),eachSeries=require("module$node_modules$async$eachSeries"),Stoplight=require("module$node_modules$web3_provider_engine$util$stoplight");require("module$node_modules$web3_provider_engine$util$rpc_cache_utils");
const createPayload=require("module$node_modules$web3_provider_engine$util$create_payload");module.exports=Web3ProviderEngine;global(Web3ProviderEngine,EventEmitter);Web3ProviderEngine.prototype.start=function(cb){const self=this;self._ready.go();self._blockTracker.on("latest",blockNumber=>{self._getBlockByNumberWithRetry(blockNumber,(err,block)=>{err?this.emit("error",err):block?(err={number:ethUtil.toBuffer(block.number),hash:ethUtil.toBuffer(block.hash),parentHash:ethUtil.toBuffer(block.parentHash),
nonce:ethUtil.toBuffer(block.nonce),mixHash:ethUtil.toBuffer(block.mixHash),sha3Uncles:ethUtil.toBuffer(block.sha3Uncles),logsBloom:ethUtil.toBuffer(block.logsBloom),transactionsRoot:ethUtil.toBuffer(block.transactionsRoot),stateRoot:ethUtil.toBuffer(block.stateRoot),receiptsRoot:ethUtil.toBuffer(block.receiptRoot||block.receiptsRoot),miner:ethUtil.toBuffer(block.miner),difficulty:ethUtil.toBuffer(block.difficulty),totalDifficulty:ethUtil.toBuffer(block.totalDifficulty),size:ethUtil.toBuffer(block.size),
extraData:ethUtil.toBuffer(block.extraData),gasLimit:ethUtil.toBuffer(block.gasLimit),gasUsed:ethUtil.toBuffer(block.gasUsed),timestamp:ethUtil.toBuffer(block.timestamp),transactions:block.transactions},self._setCurrentBlock(err),self.emit("rawBlock",block),self.emit("latest",block)):(console.log(block),this.emit("error",Error("Could not find block")))})});self._blockTracker.on("sync",self.emit.bind(self,"sync"));self._blockTracker.on("error",self.emit.bind(self,"error"));self._running=!0;self.emit("start")};
Web3ProviderEngine.prototype.stop=function(){this._blockTracker.removeAllListeners();this._running=!1;this.emit("stop")};Web3ProviderEngine.prototype.isRunning=function(){return this._running};Web3ProviderEngine.prototype.addProvider=function(source,index){"number"===typeof index?this._providers.splice(index,0,source):this._providers.push(source);source.setEngine(this)};Web3ProviderEngine.prototype.removeProvider=function(source){source=this._providers.indexOf(source);if(0>source)throw Error("Provider not found.");
this._providers.splice(source,1)};Web3ProviderEngine.prototype.send=function(payload){throw Error("Web3ProviderEngine does not support synchronous requests.");};Web3ProviderEngine.prototype.sendAsync=function(payload,cb){const self=this;self._ready.await(function(){Array.isArray(payload)?map(payload,self._handleAsync.bind(self),cb):self._handleAsync(payload,cb)})};Web3ProviderEngine.prototype._getBlockByNumberWithRetry=function(blockNumber,cb){function afterRequest(err,block){if(err)return cb(err);
block?cb(null,block):0<retriesRemaining?(retriesRemaining--,setTimeout(function(){self._getBlockByNumber(blockNumber,afterRequest)},1E3)):cb(null,null)}const self=this;let retriesRemaining=5;self._getBlockByNumber(blockNumber,afterRequest)};Web3ProviderEngine.prototype._getBlockByNumber=function(blockNumber,cb){blockNumber=createPayload({method:"eth_getBlockByNumber",params:[blockNumber,!1],skipCache:!0});this._handleAsync(blockNumber,(err,res)=>err?cb(err):cb(null,res.result))};Web3ProviderEngine.prototype._handleAsync=
function(payload,finished){function next(after){currentProvider+=1;stack.unshift(after);if(currentProvider>=self._providers.length)end(Error('Request for method "'+payload.method+'" not handled by any subprovider. Please check your subprovider configuration to ensure this method is handled.'));else try{self._providers[currentProvider].handleRequest(payload,next,end)}catch(e){end(e)}}function end(_error,_result){error=_error;result=_result;eachSeries(stack,function(fn,callback){fn?fn(error,result,
callback):callback()},function(){var resultObj={id:payload.id,jsonrpc:payload.jsonrpc,result};null!=error?(resultObj.error={message:error.stack||error.message||error,code:-32E3},finished(error,resultObj)):finished(null,resultObj)})}var self=this,currentProvider=-1,result=null,error=null,stack=[];next()};Web3ProviderEngine.prototype._setCurrentBlock=function(block){this.currentBlock=block;this.emit("block",block)}}
//# sourceMappingURL=module$node_modules$web3_provider_engine$index.js.map
